<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Amadeus API ì—¬í–‰ ì¶”ì²œ í…ŒìŠ¤íŠ¸</title>
</head>
<body>

<div>
  <input type="text" id="budget-input" placeholder="ì˜ˆì‚° (ì˜ˆ: 500000)">
  <input type="date" id="departure-input" placeholder="ì¶œë°œì¼ (ì˜ˆ: 2025-06-01)">
  <input type="date" id="return-input" placeholder="ê·€êµ­ì¼ (ì˜ˆ: 2025-06-05)">
  <button id="recommend-btn">ì—¬í–‰ ì¶”ì²œ ë°›ê¸°</button>
</div>

<div id="info-panel" style="margin-top:30px;"></div>

<script>
// ---------------------- ì„¤ì • ----------------------
const clientId = 'WYgtryOSNEKWwrvylLQNU5FwpXAaMABa';        // ğŸ”¥ ì—¬ê¸°ì— ë„¤ Client ID
const clientSecret = '3Xp8nfA8RA4ts6JX'; // ğŸ”¥ ì—¬ê¸°ì— ë„¤ Client Secret
const origin = 'ICN'; // ì¸ì²œê³µí•­
// ---------------------------------------------------

let cachedAccessToken = null;
let tokenExpiry = null;

// âœ… 1. Access Token ë°œê¸‰ (ì¬ì‚¬ìš© ê°€ëŠ¥)
async function getAccessToken() {
  const now = Date.now();

  if (cachedAccessToken && tokenExpiry && now < tokenExpiry) {
    return cachedAccessToken; // ê¸°ì¡´ í† í° ì¬ì‚¬ìš©
  }

  const response = await fetch('https://test.api.amadeus.com/v1/security/oauth2/token', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: `grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}`
  });

  if (!response.ok) {
    throw new Error('Access Token ë°œê¸‰ ì‹¤íŒ¨');
  }

  const data = await response.json();
  cachedAccessToken = data.access_token;
  tokenExpiry = now + (data.expires_in * 1000);

  console.log('Access Token ë°œê¸‰ ì™„ë£Œ âœ…');
  return cachedAccessToken;
}

// âœ… 2. ì—¬í–‰ì§€ ì¶”ì²œ ë°›ì•„ì˜¤ê¸°
async function getTravelRecommendations(token, budget, departureDate, returnDate) {
  const url = `https://test.api.amadeus.com/v1/shopping/flight-destinations?origin=${origin}&departureDate=${departureDate}&returnDate=${returnDate}&maxPrice=${budget}&currencyCode=KRW`.replace(/\s+/g, '');

  const response = await fetch(url, {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });

  if (!response.ok) {
    const errorData = await response.json();
    console.error('ì—ëŸ¬ ì‘ë‹µ:', errorData);
    throw new Error('ì—¬í–‰ì§€ ì¶”ì²œ ìš”ì²­ ì‹¤íŒ¨');
  }

  const data = await response.json();
  console.log('ì—¬í–‰ì§€ ì¶”ì²œ ë°›ì•„ì˜¤ê¸° ì™„ë£Œ âœ…');
  return data.data;
}

// âœ… 3. ì „ì²´ ì¶”ì²œ í”„ë¡œì„¸ìŠ¤
async function recommendTrip() {
  try {
    const budgetInput = document.getElementById('budget-input').value.trim();
    const departureInput = document.getElementById('departure-input').value.trim();
    const returnInput = document.getElementById('return-input').value.trim();

    
if (!budgetInput || !departureInput || !returnInput) {
  alert('ì˜ˆì‚°, ì¶œë°œì¼, ê·€êµ­ì¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!');
  return;
}

if (departureInput >= returnInput) {
  alert('ê·€êµ­ì¼ì€ ì¶œë°œì¼ë³´ë‹¤ ë‚˜ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤!');
  return;
}

if (new Date(departureInput) <= new Date()) {
  alert('ì¶œë°œì¼ì€ ë°˜ë“œì‹œ ì˜¤ëŠ˜ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤!');
  return;
}

    const token = await getAccessToken();
    const recommendations = await getTravelRecommendations(token, budgetInput, departureInput, returnInput);

    console.log('ì¶”ì²œ ì—¬í–‰ì§€ ëª©ë¡:', recommendations);

    const infoPanel = document.getElementById('info-panel');
    infoPanel.innerHTML = '<h2>ì¶”ì²œ ì—¬í–‰ì§€</h2>';

    recommendations.forEach(dest => {
      const destCode = dest.destination;
      const price = dest.price.total;
      const departure = dest.departureDate;
      const returnDate = dest.returnDate;

      const div = document.createElement('div');
      div.innerHTML = `
        <p>ëª©ì ì§€ ê³µí•­ ì½”ë“œ: ${destCode}</p>
        <p>ê°€ê²©: ${price} KRW</p>
        <p>ì¶œë°œ: ${departure} ~ ê·€êµ­: ${returnDate}</p>
        <hr>
      `;
      infoPanel.appendChild(div);
    });

  } catch (error) {
    console.error(error);
    alert('ì¶”ì²œ ì‹¤íŒ¨: ' + error.message);
  }
}

// âœ… 4. ë²„íŠ¼ ì—°ê²°
document.getElementById('recommend-btn').addEventListener('click', recommendTrip);

</script>

</body>
</html>
